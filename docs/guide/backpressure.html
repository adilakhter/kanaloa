<html><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><title>Kanaloa</title><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="description" content="Kanaloa - resiliency against traffic oversaturation" /><meta name="author" content="Kanaloa contributors" /><meta name="og:image" content="/kanaloa/img/poster.png" /><meta name="og:title" content="Kanaloa" /><meta name="og:site_name" content="Kanaloa" /><meta name="og:url" content="http://iheartradio.github.io/kanaloa" /><meta name="og:type" content="website" /><meta name="og:description" content="Kanaloa - resiliency against traffic oversaturation" /><meta name="twitter:image" content="/kanaloa/img/poster.png" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="" /><link rel="icon" type="image/png" href="/kanaloa/img/favicon.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/kanaloa/highlight/styles/atom-one-light.css" /><link rel="stylesheet" href="/kanaloa/css/style.css" /><link rel="stylesheet" href="/kanaloa/css/palette.css" /><link rel="stylesheet" href="/kanaloa/css/override.css" /></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/kanaloa/" class="brand"><div class="brand-wrapper" style="background:url('/kanaloa/img/sidebar_brand.png') no-repeat"><span>Kanaloa</span></div></a></li> <li><a href="/kanaloa/docs/guide/backpressure.html" class=" active ">Backpressure</a></li> <li><a href="/kanaloa/docs/guide/circuit-breaker.html" class="">Circuit Breaker</a></li> <li><a href="/kanaloa/docs/guide/monitor.html" class="">Realtime Monitor</a></li> <li><a href="/kanaloa/docs/guide/at-least-once.html" class="">At-least-once Delivery</a></li> <li><a href="/kanaloa/docs/guide/load-balancing.html" class="">Kanaloa and Load Balancing</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li class="hidden-xs"><a href="https://github.com/iheartradio/kanaloa"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li class="hidden-xs"><a href="https://github.com/iheartradio/kanaloa"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('Kanaloa Kanaloa - resiliency against traffic oversaturation');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('Kanaloa Kanaloa - resiliency against traffic oversaturation');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="iheartradio" data-github-repo="kanaloa"><div class="content-wrapper"><section><h2 id="backpressure">Backpressure</h2>

<p>The main feature of Kanaloa is to, as a reverse proxy, exert backpressure for a service during oversaturated traffic.
Take the following example, the incoming traffic grows to 200 requests/second, while the capacity remains at 100 requests/second. Kanaloa will reject the excessive 100 requests/second and let the service handle the other 100 requests/second with optimal speed.</p>

<p><img src="../../img/backpressure.png" alt="backpressure" /></p>

<p>Kanaloa ensures that the service under pressure works at optimal parallelity, while the optimal performance is unknown beforehand and changes over time. Kanaloa also enables control over latency caused by the queuing. For details see <a href="../theories.html">theories</a></p>

<h3 id="kanaloa-can-work-with-services-as-an-async-function-a--futureb">Kanaloa can work with services as an async Function <code class="highlighter-rouge">A =&gt; Future[B]</code></h3>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">kanaloa._</span>
<span class="k">import</span> <span class="nn">scala.concurrent._</span>
<span class="k">import</span> <span class="nn">scala.concurrent.duration._</span>
<span class="k">import</span> <span class="nn">com.typesafe.config._</span>
<span class="k">import</span> <span class="nn">scala.concurrent.ExecutionContext.Implicits.global</span>
<span class="k">val</span> <span class="n">cfg</span> <span class="k">=</span> <span class="nc">ConfigFactory</span><span class="o">.</span><span class="n">parseString</span><span class="o">(</span><span class="s">"akka { log-dead-letters = off }"</span><span class="o">)</span>

<span class="k">val</span> <span class="n">proxyFactory</span> <span class="k">=</span> <span class="nc">ReverseProxyFactory</span><span class="o">(</span><span class="n">cfg</span><span class="o">)</span>
</code></pre>
</div>

<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">service</span> <span class="k">=</span> <span class="o">(</span><span class="n">i</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Future</span><span class="o">(</span><span class="n">i</span><span class="o">.</span><span class="n">toString</span><span class="o">)</span>
<span class="c1">// service: Int =&gt; scala.concurrent.Future[String] = &lt;function1&gt;
</span>
<span class="k">val</span> <span class="n">proxy</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="nc">Future</span><span class="o">[</span><span class="kt">Either</span><span class="o">[</span><span class="kt">WorkException</span>, <span class="kt">String</span><span class="o">]]</span> <span class="k">=</span> <span class="n">proxyFactory</span><span class="o">(</span><span class="n">service</span><span class="o">)</span>
<span class="c1">// proxy: Int =&gt; scala.concurrent.Future[Either[kanaloa.WorkException,String]] = &lt;function1&gt;
</span>
<span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="n">proxy</span><span class="o">(</span><span class="mi">42</span><span class="o">)</span>
<span class="c1">// result: scala.concurrent.Future[Either[kanaloa.WorkException,String]] = List()
</span>
<span class="nc">Await</span><span class="o">.</span><span class="n">result</span><span class="o">(</span><span class="n">result</span><span class="o">,</span> <span class="mf">1.</span><span class="n">second</span><span class="o">)</span>
<span class="c1">// res1: Either[kanaloa.WorkException,String] = Right(42)
</span></code></pre>
</div>

<h3 id="kanaloa-can-work-with-services-as-actor">Kanaloa can work with services as <code class="highlighter-rouge">Actor</code></h3>
<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">import</span> <span class="nn">akka.actor.ActorDSL._</span>
<span class="k">import</span> <span class="nn">akka.actor.ActorSystem</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="n">system</span> <span class="k">=</span> <span class="nc">ActorSystem</span><span class="o">(</span><span class="s">"demo"</span><span class="o">)</span>
</code></pre>
</div>
<div class="language-scala highlighter-rouge"><pre class="highlight"><code><span class="k">val</span> <span class="n">actorService</span> <span class="k">=</span> <span class="n">actor</span><span class="o">(</span><span class="k">new</span> <span class="nc">Act</span> <span class="o">{</span>
  <span class="n">become</span> <span class="o">{</span>
    <span class="k">case</span> <span class="n">whateverQuestion</span> <span class="k">â‡’</span> <span class="n">sender</span><span class="o">()</span> <span class="o">!</span> <span class="s">"42"</span>
  <span class="o">}</span>
<span class="o">})</span>
<span class="c1">// actorService: akka.actor.ActorRef = Actor[akka://demo/user/$a#2059317969]
</span>
<span class="k">val</span> <span class="n">actorProxy</span> <span class="k">=</span> <span class="n">proxyFactory</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">String</span><span class="o">](</span><span class="n">actorService</span><span class="o">)</span>
<span class="c1">// actorProxy: kanaloa.ReverseProxy[String,String] = &lt;function1&gt;
</span>
<span class="k">val</span> <span class="n">result2</span> <span class="k">=</span> <span class="n">actorProxy</span><span class="o">(</span><span class="s">"what's the meaning of life?"</span><span class="o">)</span>
<span class="c1">// result2: scala.concurrent.Future[Either[kanaloa.WorkException,String]] = List()
</span>
<span class="nc">Await</span><span class="o">.</span><span class="n">result</span><span class="o">(</span><span class="n">result2</span><span class="o">,</span> <span class="mf">1.</span><span class="n">second</span><span class="o">)</span>
<span class="c1">// res2: Either[kanaloa.WorkException,String] = Right(42)
</span></code></pre>
</div>

</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/kanaloa/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script src="/kanaloa/js/main.js"></script></body></html>